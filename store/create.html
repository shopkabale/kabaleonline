<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Store Editor - KabaleOnline</title>
  <link rel="stylesheet" href="../style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    body { background-color: var(--bg-main); color: var(--text-main); font-family: sans-serif; }
    .editor-container { max-width: 900px; margin: 20px auto; background: var(--bg-card); border-radius: var(--border-radius); box-shadow: var(--shadow); border: 1px solid var(--border-color); overflow: hidden; }
    .sticky-nav { position: sticky; top: 0; z-index: 10; display: flex; background: var(--bg-card); border-bottom: 1px solid var(--border-color); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .nav-button { flex: 1; padding: 16px 10px; text-align: center; cursor: pointer; font-weight: 600; color: var(--text-secondary); border: none; background: none; font-size: 0.9em; border-bottom: 3px solid transparent; transition: all 0.2s ease; text-decoration: none; }
    .nav-button.active { color: var(--ko-primary); border-bottom: 3px solid var(--ko-primary); }
    .nav-button:hover { background-color: var(--bg-main); color: var(--text-main); }
    .form-section { padding: 30px; border-bottom: 1px solid var(--border-color); }
    .form-section h2 { margin-top: 0; font-size: 1.5em; }
    .form-group { margin-bottom: 25px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; }
    input, textarea, select { width: 100%; padding: 12px; box-sizing: border-box; border: 1px solid var(--border-color); border-radius: 6px; font-size: 16px; background: var(--bg-main); color: var(--text-main); }
    textarea { min-height: 100px; }
    .username-input { display: flex; }
    .username-input span { padding: 12px; background: var(--bg-light); color: var(--text-secondary); border: 1px solid var(--border-color); border-right: none; border-radius: 6px 0 0 6px; font-size: 14px; }
    .username-input input { border-radius: 0 6px 6px 0; }
    button { cursor: pointer; padding: 15px; border: none; border-radius: var(--border-radius); font-size: 1.1em; font-weight: 700; box-shadow: var(--shadow); transition: all 0.2s ease-out; }
    button:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); opacity: 0.95; }
    button:active:not(:disabled) { transform: translateY(-1px); }
    button:disabled { background: var(--border-color); color: var(--text-secondary); cursor: not-allowed; box-shadow: none; }
    .message { padding: 15px; border-radius: 6px; margin-bottom: 20px; display: none; }
    .message.success { background: #d4edda; color: #155724; }
    .message.error { background: #f8d7da; color: #721c24; }
    .message.info { background: #cce5ff; color: #004085; }
    .placeholder-msg { text-align: center; padding: 40px; }
    .placeholder-msg a { color: var(--ko-primary); font-weight: 600; text-decoration: none; }
    .loader { width: 40px; height: 40px; border: 4px solid #eee; border-top-color: var(--ko-primary); border-radius: 50%; margin: 40px auto; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .color-picker { display: flex; align-items: center; gap: 15px; }
    input[type="color"] { width: 50px; height: 40px; border: 1px solid #ddd; padding: 0; cursor: pointer; }
    .image-uploader { border: 2px dashed var(--border-color); border-radius: 6px; padding: 20px; text-align: center; cursor: pointer; }
    .image-uploader:hover { border-color: var(--ko-primary); }
    .image-uploader-preview { width: 100%; max-height: 200px; object-fit: cover; border-radius: 6px; margin-top: 15px; display: none; }
    .profile-pic-preview { width: 120px; height: 120px; object-fit: cover; border-radius: 50%; margin: 10px auto; display: none; border: 2px solid var(--border-color); }
    input[type="file"] { display: none; }
  </style>
</head>
<body>

<div class="editor-container">
  <div id="store-create-container">
    <div id="loading-spinner" class="loader"></div>
  </div>

  <template id="login-placeholder">
    <div class="placeholder-msg">
      <h3>Please Log In</h3>
      <p>You need to be logged in to manage your store.</p>
      <a href="/login/">Go to Login Page</a>
    </div>
  </template>

  <template id="form-template">
    <div class="sticky-nav">
      <a class="nav-button active" href="#section-general" data-section="general">General</a>
      <a class="nav-button" href="#section-design" data-section="design">Design</a>
      <a class="nav-button" href="#section-links" data-section="links">Links</a>
      <a class="nav-button" href="#section-footer" data-section="footer">Footer</a>
      <a class="nav-button" href="#section-extra" data-section="extra">Extras</a>
    </div>

    <form id="storeForm">
      <!-- GENERAL -->
      <section id="section-general" class="form-section">
        <h2>General Settings</h2>
        <div class="form-group">
          <label>Store Username</label>
          <div class="username-input">
            <span>/store/</span>
            <input type="text" id="storeUsername" required>
          </div>
        </div>
        <div class="form-group">
          <label>Store Name</label>
          <input type="text" id="storeName" required>
        </div>
        <div class="form-group">
          <label>Store Description</label>
          <textarea id="storeDescription"></textarea>
        </div>
        <div class="form-group">
          <label>Profile Picture</label>
          <input type="file" id="storeProfileImageFile" accept="image/png, image/jpeg">
          <label for="storeProfileImageFile" class="image-uploader">Click to upload profile photo</label>
          <img id="profileImagePreview" class="profile-pic-preview" alt="Profile preview">
        </div>
      </section>

      <!-- DESIGN -->
      <section id="section-design" class="form-section">
        <h2>Design & Layout</h2>
        <div class="form-group">
          <label>Banner / Cover Photo</label>
          <input type="file" id="storeBannerFile" accept="image/png, image/jpeg">
          <label for="storeBannerFile" class="image-uploader">Click to upload banner</label>
          <img id="bannerImagePreview" class="image-uploader-preview" alt="Banner preview">
        </div>
        <div class="form-group">
          <label>Theme Color</label>
          <div class="color-picker">
            <input type="color" id="storeThemeColor" value="#007aff">
            <span>Buttons & links color</span>
          </div>
        </div>
      </section>

      <!-- LINKS -->
      <section id="section-links" class="form-section">
        <h2>Contact & Social Links</h2>
        <div class="form-group">
          <label>WhatsApp</label>
          <input type="tel" id="linkWhatsapp">
        </div>
        <div class="form-group">
          <label>Facebook</label>
          <input type="text" id="linkFacebook">
        </div>
        <div class="form-group">
          <label>TikTok</label>
          <input type="text" id="linkTiktok">
        </div>
        <div class="form-group">
          <label>GitHub</label>
          <input type="text" id="linkGithub">
        </div>
      </section>

      <!-- FOOTER -->
      <section id="section-footer" class="form-section">
        <h2>Custom Footer</h2>
        <div class="form-group">
          <label>Footer Text</label>
          <textarea id="footerText" placeholder="Â© 2025 My Store"></textarea>
        </div>
        <div class="form-group">
          <label>Footer Color</label>
          <input type="color" id="footerColor" value="#0A0A1F">
        </div>
      </section>

      <!-- EXTRA (LOCATION, TEL, HOURS, MAP) -->
      <section id="section-extra" class="form-section">
        <h2>Extras</h2>
        <div class="form-group">
          <label>Phone Number</label>
          <input type="tel" id="storePhone" placeholder="+256...">
        </div>
        <div class="form-group">
          <label>Store Location</label>
          <input type="text" id="storeLocation" placeholder="Kabale, Uganda">
        </div>
        <div class="form-group">
          <label>Open Hours</label>
          <input type="text" id="storeHours" placeholder="Mon-Sat 9am-6pm">
        </div>
        <div class="form-group">
          <label>Google Maps Embed URL</label>
          <input type="url" id="storeMapUrl" placeholder="https://www.google.com/maps/embed?...">
        </div>
      </section>

      <div style="padding:30px;">
        <div id="messageBox" class="message"></div>
        <button type="submit" id="saveButton" style="background:var(--ko-primary);color:#fff;">Save Changes</button>
        <button type="button" id="applyTemplateBtn" style="background:var(--ko-primary);color:#fff;margin-top:10px;">Apply Template / Publish</button>
      </div>

    </form>
  </template>
</div>

<script type="module" src="../firebase.js"></script>
<script type="module" src="create.js"></script>
</body>
</html>