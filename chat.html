<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Chat | Kabale Online</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root{--primary-color:#007bff;--text-dark:#34495e;--card-bg:#fff;--bg-light:#f8f9fa}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;margin:0;background:var(--bg-light);color:var(--text-dark);padding-top:65px}
    .container{max-width:800px;margin:0 auto;padding:20px 15px}
    .sticky-header{position:fixed;top:0;left:0;right:0;z-index:1000;background:var(--card-bg);box-shadow:0 2px 5px rgba(0,0,0,.1)}
    .header-top-bar{display:flex;justify-content:space-between;align-items:center;max-width:960px;margin:0 auto;padding:8px 15px;height:65px}
    .hamburger-menu{font-size:24px;background:none;border:none;cursor:pointer;color:var(--text-dark)}
    .site-title{text-decoration:none;color:var(--text-dark);font-size:1.8em;font-weight:bold}
    .site-title span{color:var(--primary-color)}
    .header-icons{display:flex;gap:10px;align-items:center}
    #notification-bell{position:relative;border:none;background:none;cursor:pointer;font-size:18px;color:var(--text-dark)}
    #notification-count{position:absolute;top:-6px;right:-6px;background:#ff3b30;color:#fff;height:18px;min-width:18px;padding:0 5px;border-radius:9px;font-size:12px;display:none;text-align:center;line-height:18px}
    .chat-container{display:flex;flex-direction:column;background:var(--card-bg);border:1px solid #e9ecef;border-radius:8px;height:75vh;max-height:600px}
    .chat-header{background:var(--primary-color);color:#fff;padding:10px 15px;font-weight:bold;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
    .chat-header-left{display:flex;align-items:center;gap:15px}
    .chat-messages{flex-grow:1;padding:20px;overflow-y:auto;display:flex;flex-direction:column;gap:12px}
    .message{max-width:75%;padding:10px 15px;border-radius:18px;line-height:1.4;word-wrap:break-word}
    .message.sent{background:var(--primary-color);color:#fff;align-self:flex-end}
    .message.received{background:#e9ecef;color:#333;align-self:flex-start}
    .meta{font-size:0.75em;opacity:.75;margin-top:6px}
    .chat-form{display:flex;padding:10px;border-top:1px solid #e9ecef;background:#fff;flex-shrink:0}
    .chat-form input{flex-grow:1;border:1px solid #ccc;border-radius:20px;padding:10px 15px;font-size:1em}
    .chat-form button{background:var(--primary-color);color:#fff;border:none;border-radius:50%;width:45px;height:45px;margin-left:10px;cursor:pointer}
    .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:2000;display:none;align-items:center;justify-content:center}
    .modal-content{background:#fff;padding:25px;border-radius:8px;max-width:400px;width:90%;text-align:center}
    .star-rating-input{display:flex;justify-content:center;margin:20px 0;font-size:2em;cursor:pointer}
    .star{color:#ccc}.star.selected{color:#ffc107}
    footer{background:var(--text-dark);color:#fff;padding:40px 15px 20px;text-align:center;margin-top:30px}
  </style>
</head>
<body>
  <div class="mobile-nav-overlay"></div>
  <header class="sticky-header">
    <div class="header-top-bar">
      <button class="hamburger-menu" aria-label="Open menu">&#9776;</button>
      <a href="/" class="site-title">Kabale <span>Online</span></a>
      <div class="header-icons">
        <button id="notification-bell" title="Notifications"><i class="fa-solid fa-bell"></i><span id="notification-count"></span></button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="chat-container">
      <div class="chat-header">
        <div class="chat-header-left">
          <a href="/inbox.html" aria-label="Back to Inbox"><i class="fa-solid fa-arrow-left" style="color:white"></i></a>
          <span id="chat-recipient-name">Loading Chat...</span>
        </div>
        <button id="review-modal-btn" disabled>Leave a Review</button>
      </div>

      <div class="chat-messages" id="chat-messages"></div>

      <form class="chat-form" id="chat-form">
        <input type="text" id="message-input" placeholder="Type a message..." autocomplete="off" required />
        <button type="submit" aria-label="Send"><i class="fa-solid fa-paper-plane"></i></button>
      </form>
    </div>
  </main>

  <footer class="container">
    <div class="footer-logo">Kabale <span>Online</span></div>
    <p>&copy; 2025 Kabale Online. All Rights Reserved.</p>
  </footer>

  <div id="review-modal" class="modal-overlay">
    <div class="modal-content">
      <h2>Review <span id="review-recipient-name">User</span></h2>
      <form id="review-form">
        <div id="star-rating" class="star-rating-input">
          <span class="star" data-value="1">★</span>
          <span class="star" data-value="2">★</span>
          <span class="star" data-value="3">★</span>
          <span class="star" data-value="4">★</span>
          <span class="star" data-value="5">★</span>
        </div>
        <textarea id="review-text" placeholder="Share your experience..." required></textarea>
        <div style="margin-top:10px;">
          <button type="button" id="cancel-review-btn">Cancel</button>
          <button type="submit" id="submit-review-btn">Submit Review</button>
        </div>
        <p id="review-form-message" style="margin-top:10px;"></p>
      </form>
    </div>
  </div>

  <script type="module" src="ui.js"></script>
  <script type="module" src="shared.js"></script>
  <script type="module" src="chat.js"></script>
</body>
</html>